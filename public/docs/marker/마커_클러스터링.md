## 개요

네이버 지도 API를 사용하여 마커 클러스터링을 구현하는 예제입니다.

## 파일 출처

- **MarkerClustering.js**: [NAVER Maps Marker Tools](https://github.com/navermaps/marker-tools.js/blob/master/marker-clustering/src/MarkerClustering.js)
- **라이선스**: Apache License 2.0
- **저작권**: Copyright 2016 NAVER Corp.

## 주요 기능

- **다수의 마커를 효율적으로 표시**: 많은 마커를 한 번에 보여줄 때 성능을 최적화
- **줌 레벨에 따른 클러스터링**: 지도 확대/축소에 따라 마커들을 동적으로 그룹화
- **클러스터 클릭 시 확대 기능**: 클러스터를 클릭하면 해당 영역으로 줌인
- **커스텀 클러스터 아이콘**: 마커 개수에 따라 다른 스타일의 클러스터 표시
- **실시간 업데이트**: 지도 이동이나 줌 변경 시 자동으로 클러스터 재계산

## 구현 방법

### 1. 필요한 파일 import

```javascript
import "./MarkerClustering.js";
```

### 2. 마커 데이터 준비

```javascript
const locations = [
  { lat: 37.5665, lng: 126.978, title: "시청" },
  { lat: 37.5502, lng: 126.9909, title: "동대문" },
  { lat: 37.5797, lng: 126.977, title: "경복궁" },
  // ... 더 많은 위치 데이터
];
```

### 3. 마커 배열 생성

```javascript
const markers = locations.map((loc) => {
  return new naver.maps.Marker({
    position: new naver.maps.LatLng(loc.lat, loc.lng),
    title: loc.title,
  });
});
```

### 4. MarkerClustering 객체 생성

```javascript
const markerClustering = new naver.maps.MarkerClustering({
  minClusterSize: 2,           // 최소 클러스터 크기
  maxZoom: 13,                 // 클러스터링할 최대 줌 레벨
  map: map,                    // 지도 객체
  markers: markers,            // 마커 배열
  disableClickZoom: false,     // 클러스터 클릭시 줌 허용
  gridSize: 120,               // 클러스터를 형성할 그리드 크기
  icons: [...],                // 클러스터 아이콘 설정
  stylingFunction: (clusterMarker, count) => {
    // 클러스터 내 마커 개수 표시
    clusterMarker.getElement().querySelector("div").innerHTML = count;
  },
});
```

## 주요 옵션 설명

| 옵션               | 타입            | 기본값                    | 설명                                       |
| ------------------ | --------------- | ------------------------- | ------------------------------------------ |
| `map`              | naver.maps.Map  | null                      | 클러스터 마커를 올릴 지도                  |
| `markers`          | Array           | []                        | 클러스터 마커를 구성할 마커 배열           |
| `minClusterSize`   | number          | 2                         | 클러스터를 구성할 최소 마커 수             |
| `maxZoom`          | number          | 13                        | 클러스터 마커로 표현할 최대 줌 레벨        |
| `gridSize`         | number          | 100                       | 클러스터를 구성할 그리드 크기(픽셀)        |
| `disableClickZoom` | boolean         | true                      | 클러스터 마커 클릭 시 줌 동작 여부         |
| `averageCenter`    | boolean         | false                     | 클러스터 마커 위치를 평균 좌표로 설정 여부 |
| `icons`            | Array           | []                        | 클러스터 마커 아이콘 배열                  |
| `indexGenerator`   | Array\|Function | [10, 100, 200, 500, 1000] | 아이콘 선택을 위한 인덱스 생성기           |
| `stylingFunction`  | Function        | function() {}             | 클러스터 마커 갱신 시 호출되는 콜백 함수   |

## 클러스터 아이콘 설정

```javascript
icons: [
  {
    // 마커 2-10개
    content:
      '<div style="background: rgba(255, 0, 0, 0.8); color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 12px;"></div>',
    size: new naver.maps.Size(40, 40),
    anchor: new naver.maps.Point(20, 20),
  },
  {
    // 마커 10-100개
    content:
      '<div style="background: rgba(255, 165, 0, 0.8); color: white; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px;"></div>',
    size: new naver.maps.Size(50, 50),
    anchor: new naver.maps.Point(25, 25),
  },
  {
    // 마커 100개 이상
    content:
      '<div style="background: rgba(255, 20, 20, 0.8); color: white; border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;"></div>',
    size: new naver.maps.Size(60, 60),
    anchor: new naver.maps.Point(30, 30),
  },
];
```

## 주요 메서드

### 옵션 관련

- `setOptions(options)`: 클러스터링 옵션 설정
- `getOptions(key)`: 클러스터링 옵션 반환

### 마커 관련

- `setMarkers(markers)`: 클러스터링할 마커 배열 설정
- `getMarkers()`: 현재 마커 배열 반환

### 설정 관련

- `setMinClusterSize(size)`: 최소 클러스터 크기 설정
- `setMaxZoom(zoom)`: 최대 줌 레벨 설정
- `setGridSize(size)`: 그리드 크기 설정
- `setIcons(icons)`: 클러스터 아이콘 설정
- `setStylingFunction(func)`: 스타일링 함수 설정

## 사용 시 주의사항

1. **성능 최적화**: 마커가 많을 때는 `gridSize`를 적절히 조정하여 성능을 최적화하세요.

2. **줌 레벨 설정**: `maxZoom` 값을 너무 높게 설정하면 고줌에서도 클러스터가 유지되어 개별 마커를 볼 수 없을 수 있습니다.

3. **메모리 관리**: 컴포넌트 언마운트 시 클러스터링 객체를 정리해야 합니다.

```javascript
useEffect(() => {
  // 클러스터링 설정...

  return () => {
    if (markerClustering) {
      markerClustering.setMap(null);
    }
  };
}, []);
```

4. **아이콘 스타일**: HTML 아이콘을 사용할 때는 CSS 스타일이 제대로 적용되는지 확인하세요.

## 참고 문서

[NAVER Maps Marker Tools](https://github.com/navermaps/marker-tools.js/blob/master/marker-clustering/src/MarkerClustering.js)

[velog-sumi](https://velog.io/@sumi-0011/react-naver-map-%EB%84%A4%EC%9D%B4%EB%B2%84-%EB%A7%88%EC%BB%A4-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0%ED%99%94%ED%95%98%EA%B8%B0-%EB%AC%B8%EC%84%9C-%EB%94%B0%EB%9D%BC%EA%B0%80%EA%B8%B0)
